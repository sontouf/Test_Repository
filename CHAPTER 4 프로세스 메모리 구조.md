#PART 2 메모리

# CHAPTER 4 프로세스 메모리 구조

4장에서는 프로세스 내부의 메모리 및 메모리 구조를 다룬다. C 언어 개발자에게 메모리 관리는 언제나 중요하며, 가장 좋은 방식을 적용하려면 메모리 구조에 관한 기초 지식이 필요하다. 이는 사실 C 언어에만 국한되지는 않는다. C++이나 자바와 같은 여러 프로그래밍 언어도 메모리 및 메모리 작동방식을 근본적으로 이해해야 한다. 이해하지 못하면 문제를 쉽게 추적하거나 수정하기 어려운 문제와 마주하게 된다.

C언어에서 메모리는 완전히 수동으로 관리된다. 메모리 영역을 할당하거나 또는 더 이상 필요하지 않게 된 메모리를 해제하는 일은 개발자만이 담당한다.

자바나 C#과 같은 고수준 프로그래밍 언어의 경우 C 와는 메모리 관리 방식이 다르다. 일부는 개발자가, 일부는 기본 언어 플랫폼이 메모리를 관리한다. 자바를 사용한다면 __자바 가상 머신(JVM)이 기본 언어 플랫폼에 해당한다. 이러한 언어에서 메모리를 할당할 수 있는 건 개발자뿐이지만, 메모리 해제가 반드시 개발자에게 달려 있는 것은 아니다. 가비지 컬렉터라는 컴포넌트가 기존의 할당된 메모리를 자동을 해제한다.

C와 C++에는 이러한 가비지 컬렉터가 없으므로, 메모리 관리의 개념 및 문제를 다루는 장이 필요하다. 그러므로 이번 4장과 다음 5장에서 메모리 개념을 집중적으로 살펴볼 것이며, 이를 통해 C/C++의 메모리 작동 방식을 기초부터 이해해보자.

4장에서는 다음 내용을 배운다.

- 프로세스의 일반적인 메모리 구조를 살펴보자. 프로세스의 구조 및 메모리와 프로세스의 상호작용 방식을 알아보는 데 도움이 될 것이다.
- 정적 메모리 레이아웃과 동적 메모리 레이아웃을 다룬다.
- 앞서 언급한 메모리 레이아웃에 나온 세그먼트를 소개한다. 실행 가능한 목적 파일에 탑재된 세그먼트와 프로세스가 로딩되는 동안 만들어지는 세그먼트를 살펴본다.
- 메모리 조사 도구 및 명령어를 소개한다. 이는 세그먼트를 감지하고 세그먼트의 내용을 볼 수 있게 도와준다 메모리 조사 도구와 명령어는 목적  파일과 실행 중인 프로세스 내부에 있다.

이번 장에서는 __스택__ 과 __힙__ 세그먼트를 소개한다. 스택과 힙은 프로세스의 동적 메모리 레이아웃에 속하며, 모든 메모리 할당과 해제는 이 세그먼트에서 일어난다. 스택과 힙은 다음 장에서 더 상세하기 다룬다. 실제로 개발자가 스택과 힙을 가장 많이 다루기 때문이다.

__프로세스 메모리 레이아웃__ 부터 시작해보자. 실행 중인 프로세스의 메모리가 세그먼트로 분할되는 방식과 각 세그먼트의 용도를 전반적으로 보자



## 4. 1 프로세스 메모리 레이아웃

실행 파일을 열 때마다 운영체제는 새 프로세스를 만든다. 프로세스는 실행중인 프로그램이며 이 프로그램은 메모리에 로딩된다. 그리고 고유의 __프로세스 식별자(PID)__ 를 가진다. 운영체제는 새 프로세스의 스폰과 로딩을 담당하는 유일한 개체이다.

프로세스는 정상적으로 종료될 때까지, 또는 SIGTERM, SIGINT, SIGKILL과 같은 종료 신호가 주어질 때까지 계속 실행된다. SIGTERM와 SIGINT 신호는 무시될 수 있지만, SIGKILL은 프로세스를 강제로 즉시 종료하도록 한다.

```
- SIGTERM : 종료신호이다. 프로세스를 청소하도록 한다.
- SIGINT : 인터럽트 신호이다. ctrl+c 를 눌러 포그라운드 프로세스로 전달한다.
- SIGKILL : 킬 신호이다. 프로세스를 청소하지 않고 강제로 종료한다.
```

프로세스를 생성할 때 운영체제는 프로세스를 위한 메모리를 가장 먼저 할당한 다음, 미리 정의된 메모리 레이아웃을 적용한다. 이렇게 미리 정의된 메모리 레이아웃은 특히 유닉스 계열의 다른 운영체제에서도 거의 같다.

일반적인 프로세스의 메모리 레이아웃은 여러부분으로 분할된다. 각 부분은 __세그먼트__ 라고 한다. 각 세그먼트는 정해진 작업을 수행하며 특정 자료형을 저장하는 메모리 영역이다. 다음은 실행 중인 프로세스의 메모리 레이아웃에 포함되는 목록이다.

- 초기화되지 않은 데이터 세그먼트 또는 BSS(block started by symbol) 세그먼트
- 데이터 세그먼트
- 텍스트 세그먼트 또는 코드 세그먼트
- 스택 세그먼트
- 힙 세그먼트



## 4.2 메모리 구조 알아보기

















