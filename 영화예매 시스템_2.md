# 데이터 중심의 영화예매 시스템

이전까지는 책임을 기준으로 시스템을 분할한 영화예매 시스템의 설계를 살펴봤다. 지금부터는 관점을 바꿔서 데이터를 기준으로 분할한 영화예매 시스템의 설계를 살펴보자.



## 데이터를 준비하자

```java
public class Movie {
    private String title;
    private Duration runningTime;
    private Money fee;
    private List<DiscountCondition> discountConditions;
    
    private MovieType movieType;
    private Money discountAmount;
    private double discountPercent;
}
```

데이터 중심의 Movie  클래스 역시 책임 중심의 Movie 클래스와 마찬가지로 영화를 표현하는 가장 기본적인 정보인 영화제목, 상영시간, 기본요금을 인스턴스 변수로 포함한다. 하지만 기존의 설계와 동일한 부분은 여기까지다.

가장 두드러지는 차이점은 할인 조건의 목록(discountConditions) 이 인스턴스 변수로 Movie 안에 직접 포함돼 있다는 것이다. 또한 할인 정책을 DiscountPolicy 라는 별도의 클래스로 분리했던 이전 예제와 달리 금액 할인 정책에 사용되는 할인 금액(discountAmount)과 비율 할인 정책에 사용되는 할인 비율(discountPercent) 을 Movie 안에서 직접 정의하고 있다.

 할인 정책은 영화별로 오직 하나만 지정할 수 있기 때문에 한 시점에 discountAmount 와 discountPercent 중 하나의 값만 사용될 수 있다. 그렇다면 영화에 사용된 할인 정책의 종류를 어떻게 알 수 있을까? 할인 정책의 종류를 결정하는 것이 바로 movieType이다. movieType 은 현재 영화에 설정된 할인 정책의 종류를 결정하는 열거형 타입인 movieType 의 인스턴스다.

 ```java
public enum MovieType {
    AMOUNT_DISCOUNT,	// 금액 할인 정책
    PERCENT_DISCOUNT,	// 비율 할인 정책
    NONE_DISCOUNT		// 미적용
}
 ```

 

이것은 말 그대로 데이터 중심의 접근 방법이다. 할인금액을 계산하는 데 필요한 데이터는? 어떤 데이터가 필요하나? 등등 객체가 포함해야 하는 데이터에 집중한다. 객체의 책임을 결정하기 전에 이런 질문의 반복에 휩쓸려 있다면 데이터 중심의 설계에 매몰돼 있을 확률이 높다. 특히 Movie 클래스의 경우처럼 객체의 종류를 저장하는 인스턴스 변수와 인스턴스의 종류에 따라 배타적으로 사용될 인스턴스 변수를 하나의 클래스 안에 함께 포함시키는 방식은 데이터 중심의 설계 안에서 흔히 볼 수 있는 패턴이다.

 객체지향의 가장 중요한 원칙은 캡슐화이므로 내부 데이터가 객체의 엷은 막을 빠져나가 외부의 다른 객체들을 오염시키는 것을 막아야 한다. 이를 달성할 수 있는 가장 간단한 방법은 내부의 데이터를 반환하는 __accessor__ 와 데이터를 변경하는 __mutator__를 추가하는 것이다.



```java
public class Movie {
    private String title;
    private Duration runningTime;
    private Money fee;
    private List<DiscountCondition> discountConditions;
    
    private MovieType movieType;
    private Money discountAmount;
    private double discountPercent;
    
    public MovieType getMovieType() {
        return movieType;
    }
    
    public void setMovieType(MovieType movieType) {
        this.movieType = movieType;
    }
    
    public Money getFee() {
        return fee;
    }
    
    public void setFee(Money fee) {
        this.fee = fee;
    }
    
    public List<DiscountCondition> getDiscountConditions() {
        return Collections.unmodifiableList(discountConditions);
    }
    
    public void setDiscountConditions(List<DiscountCondition> discountConditions) {
        this.discountConditions = discountConditions;
    }
    
    public Money getDiscountAmount() {
        return discountAmount;
    }
    
    public void setDisscountAmount(Money discountAmount) {
        this.discountAmount = discountAmount;
    }
    
    public double getDiscountPercent() {
        return discountPercent;
    }
    
    public void SetDiscountPercent(double discountPercent) {
        this.discountPercent = discountPercent;
    }
}
```



이제 할인 조건을 구현해보자. 영화 예매 도메인에는 순번 조건과 기간 조건이라는 두 가지 종류의 할인 조긴이 존재한다. 순번 조건은 상영 순번을 이용해 할인 여부를 판단하고 기간 조건은 상영 시간을 이용해 할인 여부를 판단한다.

할인 조건을 구현하는 데 필요한 데이터는 무엇인가? 힐안 조건의 타입을 저장할 DiscountConditionType을 저장하자.

```java
public enum DiscountConditionType {
    SEQUENCE,	// 순번 조건
    PERIOD		// 기간 조건
}
```

할인 조건을 구현하는 DiscountCondition 은 할인 조건의 타입을 저장할 인스턴스 변수인 type 을 포함한다. 또한 movieType 의 경우와 마찬가지로 순번 조건에서만 사용되는 데이터인 요일, 시작 시간, 종료 시간을 함께 포함한다.

```java
public class DiscountCondition {
    private DiscountConditionType type;
    
    private int sequence;
    
    private DayOfWeek dayOfWeek;
    private LocalTime startTime;
    private LocalTime endTime;
}
```

캡슐화의 원칙에 따라 이 속성들을 클래스 외부로 노출해서는 안된다. 메서드를 추가하자.

```java
public class DiscsountCondition {
    public DiscountConditionType getType() {
        return type;
    }
    
    public void setType(DiscountConditionType type) {
        this.type = type;
    }
    
    public DayOfWeek getDayOfWeek() {
        return dayOfWeek;
    }
    
    public LocalTime getStartTime() {
        return startTime;
    }
    
    public void setStartTime(LocalTime startTime) {
        this.startTime = startTime;
    }
    
    public LocalTime getEndTime() {
        return endTime;
    }
    
    public void setEndTime(LocalTime endTime) {
        this.endTime = endTime;
    }
    
    public int getSequence() {
        return sequence;
    }
    
    public void setSequence(int sequence) {
        this.sequence = sequence;
    }
}
```



Screening 클래스를 구현하자.

```java
public class Screening {
    private Movie movie;
    private int sequence;
    private LocalDataTime whenScreend;
    
    public Movie getMovie() {
        return movie;
    }
    public void setMovie(Movie movie) {
        this.movie = movie;
    }
    
    public LocalDataTime getWhenScreened() {
        return whenScreened;
    }
    
    public void setWhenScreened(LocalDateTime whenScreened) {
        this.whenScreened = whenScreened;
    }
    
    public int getSequence() {
        return sequence;
    }
    
    public void setSequence(int sequence) {
        this.sequence = sequence;
    }
}
```

영화 예매시스템의 목적은 영화를 예매하는 것이다.

```java
public class Reservation {
    private Customer customer;
    private Screening screening;
    private Money fee;
    private int audienceCount;
    
    public Reservation(Customer customer, Screening screening, Money fee, int audienceCount) {
        this.customer = customer;
        this.screening = screening;
        this.fee = fee;
        this.audienceCount = audienceCount;
    }
    
    public Customer getCustomer() {
        return customer;
    }
    
    public void setCustomer(Customer customer) {
        this.customer = customer;
    }
    
    public Screening getScreening() {
        return screening;
    }
    
    public Money getFee() {
        return fee;
    }
    
    public void setFee(Money fee) {
        this.fee = fee;
    }
    
    public int getAudienceCount() {
        return audienceCount;
    }
    
    public void setAudienceCount(int audienceCount) {
        this.audienceCount = audienceCount;
    }
}
```

Customer 은 고객의 정보를 담는 클래스다.

```java
public class Customer {
    private String name;
    private String id;
    
    public Customer(String name, String id) {
        this.id = id;
        this.name = name;
    }
}
```







